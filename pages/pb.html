<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <title>Blood</title>
    <script src="https://kit.fontawesome.com/f6f9c2cc49.js" crossorigin="anonymous"></script>
    <style>
      ::-webkit-input-placeholder {
        color: black;
        opacity: 1 !important;
      }

      input:focus::placeholder {
        color: transparent;
      }

      div {
        font-family: Arial;
        font-size: 11pt;
      }

      textarea {
        max-width: 100%;
      }

      br {
        font-family: Arial;
        font-size: 11pt;
      }

      input {
        display: inline-block;
        padding: 0px 0px;
        line-height: 80%;
      }


      table {
        border-collapse: collapse;
        font-family: Arial;
        table-layout: fixed;
        font-size: 11pt;
      }

      th,
      td {
        border: 1px solid black;
        vertical-align: text-top;

      }

      label {
        font-weight: Normal;
        padding-right: 15px;
        padding-left: 0px;
      }

      a:link {
        text-decoration: none;
      }

      a:visited {
        text-decoration: none;
      }

      .noborder {
        border: none;
      }

      .center {
        text-align: center;
      }

      .banner {
        position: -webkit-sticky;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .bannertop {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        align-items: stretch;
        border: solid black;
      }

      .bannertopitem {
        color: white;
        font-size: 20pt;
        font-weight: bold;
        padding: 0;
        margin: 0;
        flex-basis: 33.33%;
        background-color: rgb(43, 60, 90);
      }

      .bannerbottom {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        align-items: stretch;
        border-top: none;
      }

      .bannerbottomitem {
        color: white;
        font-size: 20pt;
        font-weight: bold;
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        flex-basis: 50%;
        background-color: rgb(43, 60, 90);
      }

      button {
        background-color: rgb(43, 60, 90);
        color: white;
        font-size: 20pt;
        border-radius: 5px;
        border: none;
        cursor: pointer;
      }

      .flex-div {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
      }

      .flex-table-div {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        width: 100%;
        align-content: stretch;
        justify-content: space-between;
      }

      .panelleft {
        box-sizing: border-box;
        flex-basis: 50%;
        border-right: solid black;
        min-height: 100vh;
      }

      .panelright {
        flex-basis: 50%;
      }

      .template-body {
        padding: 10px;
      }

      .rightpanelbutton {
        cursor: pointer;
      }

      .navigationButton {
        cursor: pointer;
      }

      .spread {
        padding-top: 5px;
        padding-bottom: 5px;
      }

      .table-flex {
        flex-basis: 70%;
      }

      .table-settings-flex {
        flex-basis: 25%;
      }

      .labelnopad {
        padding-right: 0px;
      }

      .pad {
        padding: 10px;
      }

      .top {
        padding-top: 15px;
      }

      .left {
        padding-left: 15px;
      }

      .bottom {
        padding-bottom: 15px;
      }

      .right {
        padding-right: 15px;
      }

      .h1 {
        font-size: 14pt;
        font-family: Arial;
        font-weight: bold;
        font-style: italic;
        margin: 0px;
      }

      .h2 {
        font-size: 11pt;
        font-family: Arial;
        font-weight: bold;
        text-decoration: underline;
        margin: 0px;
      }

      .smallText {
        font-size: 8pt;
        font-family: Arial;
      }

      .header {
        font-size: 11pt;
        font-family: Arial;
        font-weight: bold;
        margin: 0px;

      }

      .clickedIcon {
        color: lime;
      }

      .clickedIcon:hover {
        color: lime;
      }

      .iconHead {
        background-color: rgb(43, 60, 90);
        color: white;
        display: flex;
        justify-content: space-around;
        border-left: solid black;
        border-right: solid black;
        border-bottom: solid black;
        -webkit-flex-flow: row wrap;
      }

      .iconPanel {
        font-size: 20pt;
        padding: 5px;
        cursor: pointer
      }

      .icon:hover {
        color: rgb(200, 200, 200);
      }

      .fullBorder {
        border-style: solid;
        border-color: black;
      }

      html {
        overflow-y: scroll;
      }

      body {
        margin: 0px;
      }

      html,
      body {
        margin: 0;
        height: 100vh;
      }

      .copyHead {
        background-color: rgb(43, 60, 90);
        color: white;
        display: flex;
        justify-content: space-around;
        border-right: solid black;
        border-bottom: solid black;
        -webkit-flex-flow: row wrap;
      }

      .copyPanel:hover {
        color: white;
      }

      .copyText:hover {
        color: rgb(200, 200, 200);
      }

      .copyPanel {
        font-size: 20pt;
        padding: 5px;
      }

      .copyText {
        font-size: 14pt;
        padding: 5px;
        cursor: pointer
      }

      .copyText:active {
        color: lime;
      }

      .neg {
        margin-top: -32px;
      }

      .side-pad {
        padding-left: 10px;
        padding-right: 10px;
      }

      .a {
        font-family: Arial;
        font-size: 12pt;
      }

      .other {
        width: 100%;
        display: flex;
      }

      .otherInput {
        flex: 2;
      }

      .navigation {
        position: absolute;
        background-color: rgb(43, 60, 90);
        z-index: 20;
        top: 0px;
        left: 0;
        width: 200px;
        height: 100%;
        border: solid;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 30px;
        height: 22px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 4px;
        bottom: 2px;
        background-color: white;
        -webkit-transition: .3s;
        transition: .3s;
      }

      input:checked+.slider {
        background-color: rgb(43, 60, 90);
      }

      input:focus+.slider {
        box-shadow: 0 0 1px #2196F3;
      }

      input:checked+.slider:before {
        -webkit-transform: translateX(19px);
        -ms-transform: translateX(19px);
        transform: translateX(19px);
      }

      /* Rounded sliders */
      .slider.round {
        border-radius: 20px;
      }

      .slider.round:before {
        border-radius: 50%;
      }

      #settingTable {
        width: 100%;
        border: none;
      }

      #settingTable td {
        vertical-align: middle;
        border: none;
      }

      }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta charset="utf-8">
    <title></title>

  </head>

  <body>
    <div class="container-fluid" id="bmTemp">
      <div class="banner">
        <div class="bannertop">
          <div class="bannertopitem">
            <i class="fas fa-bars pad navigationButton"></i>
          </div>
          <div class='bannertopitem' style='text-align: center; padding: 8px'>
            Peripheral Blood Template
          </div>
          <div class='bannertopitem' style='text-align: right'>

            <i class="clickedIcon fas fa-list pad rightpanelbutton" id="templateButton"></i>
            <i class="icon fas fa-book pad rightpanelbutton" id='educationButton'></i>
            <i class="icon far fa-question-circle pad rightpanelbutton" id="helpButton"></i>
            <i class="icon fas fa-cog pad rightpanelbutton" id='settingsButton'></i>
          </div>
        </div>
        <div class="bannerbottom">
          <div class='bannerbottomitem iconHead'>
            <i class="iconPanel icon fas fa-tint pad" id='description'></i>
            <i class="iconPanel icon fas fa-bars pad" id='comment'></i>
          </div>
          <div class='bannerbottomitem copyHead' id='copyPanel'>
            <span class="copy copyText" id="finalCopy">Copy Final Text</span></div>
        </div>
      </div>
      <div class="flex-div">
        <div id='navigationPanel' class='navigation' style='display:none'>

          <div class="bannertopitem">
            <i class="fas fa-bars pad navigationButton"></i>
            <br>

            <a href="https://pathtemp.github.io/pages/bonemarrow.html" style="color: white; font-size: 12pt">&nbsp Bone Marrow</a>
          </div>
        </div>
        <div class="panelleft">
          <div class="template-body" id="descriptionPanel">
            <div>
              <div>
                <b>Paste CBC Here:</b>
                <textarea rows="2" id="pbCBC" style="width: 100%"></textarea>
              </div>
              <input type="checkbox" id="toggleCBC" checked>
              <label for="toggleCBC"> Toggle CBC</label><br>
            </div>
            <br>
            <div id="pbDiv">
              <span><b><u>RBCs</u></b><input type="checkbox" id="rbcShow">
                <label for="rbcShow"> Show all</label></span>
              <div id="rbcDiv">
                <div id="hgbAdequateDiv">
                  <input type="checkbox" id="hgbAdequate" class="rbcQuant">
                  <label for="hgbAdequate"><b>RBC1:</b> Hemoglobin is adequate.</label>
                </div>
                <div id="normoAnemiaDiv" class="flex-div" style="flex-wrap: wrap">
                  <div>
                    <input type="checkbox" id="normoAnemia" class="rbcQuant">
                    <label for="normoAnemia"><b>RBC2:</b> Normocytic anemia.</label><br>
                  </div>
                  <div>
                    <input type="checkbox" id="hypochromicNormo">
                    <label for="hypochromicNormo">Hypochromic</label>
                  </div>
                </div>
                <div id="microAnemiaDiv" class="flex-div" style="flex-wrap: wrap">
                  <div>
                    <input type="checkbox" id="microAnemia" class="rbcQuant">
                    <label for="microAnemia"><b>RBC3:</b> Microcytic anemia.</label>
                  </div>
                  <div>
                    <input type="checkbox" id="hypochromicMicro">
                    <label for="hypochromicMicro">Hypochromic</label>
                  </div>

                </div>
                <div id="macroAnemiaDiv">
                  <input type="checkbox" id="macroAnemia" class="rbcQuant">
                  <label for="macroAnemia"><b>RBC4:</b> Macrocytic anemia.</label><br>
                </div>
                <div id="rbcDescriptionDiv" class="flex-div spread" style="flex-wrap: wrap"><input type="checkbox" id="rbcDescription"><label for="rbcDescription">&nbsp<b>RBC5:</b> Red blood cells show</label>
                  <div>
                    <input type="radio" id="rbcUnremarkable">
                    <label for="rbcUnremarkable"> Unremarkable morphology</label>
                  </div>
                  <div>
                    <input type="checkbox" id="poly">
                    <label for="poly"> Polychromasia</label>
                  </div>
                  <div>
                    <input type="checkbox" id="aniso">
                    <label for="aniso"> Anisopoikilocytosis</label><br>
                  </div>
                  <div>
                    <input type="checkbox" id="mildAniso">
                    <label for="mildAniso"> Mild anisopoikilocytosis</label><br>
                  </div>
                </div>
                <div id="anisoContainerDiv" class="flex-div" style="flex-wrap: wrap">
                  <input type="checkbox" id="including">
                  <label for="including">&nbsp<b>RBC6:</b> Including:</label>
                  <div id="anisoDiv"></div>
                </div>

                <div id="nrbcDiv">
                  <input type="checkbox" id="nrbc">
                  <label for="nrbc"><b>RBC7:</b> Nucleated red blood cells identified.</label><br>
                </div>
                <div id="nrbcQuantDiv" class="flex-div" style="flex-wrap: wrap">
                  <div>
                    <input type="radio" name="nrbc" id="nrbcFrequent">
                    <label for="nrbcFrequent"> Frequent</label>
                  </div>
                  <div>
                    <input type="radio" name="nrbc" id="nrbcOccasional">
                    <label for="nrbcOccasional"> Occasional</label>
                  </div>
                  <div>
                    <input type="radio" name="nrbc" id="nrbcRare">
                    <label for="nrbcRare"> Rare</label>
                  </div>
                </div>
                <div id="agglutinationDiv">
                  <input type="checkbox" id="agglutination">
                  <label for="agglutination"><b>RBC8:</b> Red blood cells show agglutination. See comment.</label>
                </div>
                <div id="rbcOtherDiv" class="other">
                  <input type="checkbox" id="rbcOther">
                  <label for="rbcOther">&nbsp<b>Other:</b></label>
                  <input type="text" class="otherInput" id="rbcOtherInput">
                </div>
              </div>
              <br>
              <span><b><u>Neutrophils/Blasts</u></b><input type="checkbox" id="neutShow"><label for="neutShow"> Show all</label></span>
              <div id="neutDiv">
                <div id="neutQuantDiv">
                  <div id="adequateNeutDiv">
                    <input type="checkbox" id="adequateNeut">
                    <label for="adequateNeut"><b>WBC1:</b> Neutrophils are adequate.</label>
                  </div>
                  <div id="neutrophiliaDiv">
                    <input type="checkbox" id="neutrophilia">
                    <label for="neutrophilia"><b>WBC2:</b> Absolute neutrophilia.</label>
                  </div>
                  <div id="neutropeniaDiv">
                    <input type="checkbox" id="neutropenia">
                    <label for="neutropenia"><b>WBC3:</b> Absolute neutropenia.</label>
                  </div>
                </div>

                <div id="neutDescriptionDiv" class="flex-div spread" style="flex-wrap: wrap"><input type="checkbox" id="neutDescription"><label for="neutDescription">&nbsp<b>WBC4:</b> Neutrophils show</label>
                  <div>
                    <input type="radio" id="neutUnremarkable">
                    <label for="neutUnremarkable"> Unremarkable morphology</label>
                  </div>

                  <div>
                    <input type="checkbox" id="toxic" class="neutAbnormal">
                    <label for="toxic"> Toxic changes</label>
                  </div>
                  <div>
                    <input type="checkbox" id="neutShift" class="neutAbnormal">
                    <label for="neutShift"> Shift to immaturity</label><br>
                  </div>
                  <div>
                    <input type="checkbox" id="neutHypolobated" class="neutAbnormal">
                    <label for="neutHypolobated"> Hypolobated nuclei</label><br>
                  </div>
                  <div>
                    <input type="checkbox" id="neutHypogranular" class="neutAbnormal">
                    <label for="neutHypogranular"> Hypogranular forms</label><br>
                  </div>
                </div>
                <div id="monocytosisDiv">
                  <input type="checkbox" id="monocytosis">
                  <label for="monocytosis"><b>WBC5:</b> Absolute monocytosis with mature-appearing morphology.</label>
                </div>
                <div id="eosinophiliaDiv">
                  <input type="checkbox" id="eosinophilia">
                  <label for="eosinophilia"><b>WBC6:</b> Absolute eosinophilia.</label>
                </div>
                <div id="basophiliaDiv">
                  <input type="checkbox" id="basophilia">
                  <label for="basophilia"><b>WBC7:</b> Absolute basophilia.</label>
                </div>
                <div id="blastDiv">
                  <input type="checkbox" id="blast">
                  <label for="blast" id="blastLabel"><b>WBC8:</b> Blasts are present. See comment.</label>
                </div>
                <div id="neutOtherDiv" class="other">
                  <input type="checkbox" id="neutOther">
                  <label for="neutOther">&nbsp<b>Other:</b></label>
                  <input type="text" class="otherInput" id="neutOtherInput">
                </div>
              </div>
              <br>
              <span><b><u>Lymphocytes</u></b><input type="checkbox" id="lymphShow">
                <label for="lymphShow"> Show all</label></span>
              <div id="lymphDiv">
                <div id="lymphQuantDiv">
                  <div id="lymphocytosis">
                    <div id="lymphocytosisSLDiv">
                      <input type="checkbox" id="lymphocytosisSL">
                      <label for="lymphocytosisSL" id="lymphSLLabel"><b>WBC9:</b> Absolute lymphocytosis consisting of small mature lymphocytes and large granular lymphocytes.</label>
                    </div>
                    <div id="lymphocytosisReactDiv">
                      <input type="checkbox" id="lymphocytosisReact">
                      <label for="lymphocytosisReact" id="lymphReactLabel"><b>WBC10:</b> Absolute lymphocytosis consisting of a heterogenous population of lymphocytes including small mature lymphocytes, large granular lymphocytes, and activated lymphocytes.</label>
                    </div>
                    <div id="lymphocytosisNeoplasticDiv">
                      <input type="checkbox" id="lymphocytosisNeoplastic">
                      <label for="lymphocytosisNeoplastic" id="lymphNeoplasticLabel"><b>WBC11:</b> Absolute lymphocytosis consisting of a population of predominantly small to medium-sized lymphocytes with clumped chromatin. See comment.</label>
                    </div>
                  </div>
                  <div id="lymphopeniaDiv">
                    <input type="checkbox" id="lymphopenia">
                    <label for="lymphopenia"><b>WBC12:</b> Absolute lymphopenia.</label>
                  </div>
                </div>

                <div id="lymphOtherDiv" class="other">
                  <input type="checkbox" id="lymphOther">
                  <label for="lymphOther">&nbsp<b>Other:</b></label>
                  <input type="text" class="otherInput" id="lymphOtherInput">
                </div>

              </div>
              <br>
              <span><b><u>Platelets</u></b><input type="checkbox" id="pltShow"><label for="pltShow"> Show all</label></span>
              <div id="pltDiv">

                <div id="adequatePltDiv" class="flex-div" style="flex-wrap: wrap">
                  <div>
                    <input type="checkbox" id="adequatePlt" class="pltQuant">
                    <label for="adequatePlt"><b>PLT1:</b> Platelets are adequate with</label>
                  </div>
                  <div>
                    <input type="radio" name="adequate" id="adequatePltUM">
                    <label for="adequatePltUM"> Unremarkable morphology.</label>
                  </div>
                  <div>
                    <input type="radio" name="adequate" id="adequatePltOL">
                    <label for="adequatePltOL"> Occasional large platelets.</label>
                  </div>
                </div>
                <div id="thrombocytosisDiv" class="flex-div" style="flex-wrap: wrap">
                  <div>
                    <input type="checkbox" id="thrombocytosis" class="pltQuant">
                    <label for="thrombocytosis"><b>PLT2:</b> Thrombocytosis with</label>
                  </div>
                  <div>
                    <input type="radio" name="thrombocytosis" id="thrombocytosisUM">
                    <label for="thrombocytosisUM"> Unremarkable platelet morphology.</label>
                  </div>
                  <div>
                    <input type="radio" name="thrombocytosis" id="thrombocytosisOL">
                    <label for="thrombocytosisOL"> Occasional large platelets.</label>
                  </div>
                </div>
                <div id="thrombocytopeniaDiv" class="flex-div" style="flex-wrap: wrap">
                  <div>
                    <input type="checkbox" id="thrombocytopenia" class="pltQuant">
                    <label for="thrombocytopenia"><b>PLT3:</b> Thrombocytopenia with</label>
                  </div>
                  <div>
                    <input type="radio" name="thrombocytopenia" id="thrombocytopeniaUM">
                    <label for="thrombocytopeniaUM"> Unremarkable platelet morphology.</label>
                  </div>
                  <div>
                    <input type="radio" name="thrombocytopenia" id="thrombocytopeniaOL">
                    <label for="thrombocytopeniaOL"> Occasional large platelets.</label>
                  </div>
                </div>
                <div>
                  <input type="checkbox" id="pltClumping">
                  <label for="pltClumping"><b>PLT4:</b> Platelet clumping is present. See comment.</label>
                </div>
                <div id="pltOtherDiv" class="other">
                  <input type="checkbox" id="pltOther">
                  <label for="pltOther">&nbsp<b>Other:</b></label>
                  <input type="text" class="otherInput" id="pltOtherInput">
                </div>
              </div>
            </div>
          </div>
          <div class="template-body" id="commentPanel" style="display: none">
            <div>
              <span><b><u>Anemia and Hemolysis Comments</u></b><input type="checkbox" id="rbcCommentsShow" class="commentsShow">
                <label for="rbcCommentsShow"> Show all</label></span>
              <div id="RBCC1Div" style="display: none">
                <input type="checkbox" id="RBCC1" class="pbComment">
                <label for="RBCC1"><b>RBCC1:</b> The etiology of the patient's anemia is not clear on review of the peripheral blood smear.</label>
              </div>
              <div id="RBCC2Div" style="display: none">
                <input type="checkbox" id="RBCC2" class="pbComment">
                <label for="RBCC2"><b>RBCC2:</b> There is no morphologic evidence of hemolysis. Clinical correlation is suggested.</label>
              </div>
              <div id="RBCC3Div" style="display: none">
                <input type="checkbox" id="RBCC3" class="pbComment">
                <label for="RBCC3"><b>RBCC3:</b> The red cell indices, morphology, and iron studies are consistent with iron deficiency anemia.</label>
              </div>
              <div id="RBCC4Div" style="display: none">
                <input type="checkbox" id="RBCC4" class="pbComment">
                <label for="RBCC4"><b>RBCC4:</b> The red cell indices and morphology are suggestive of iron deficiency anemia.</label>
              </div>
              <div id="RBCC5Div" style="display: none">
                <input type="checkbox" id="RBCC5" class="pbComment">
                <label for="RBCC5"><b>RBCC5:</b> The red cell indices, morphology, and iron studies are consistent with anemia of chronic disease.</label>
              </div>
              <div id="RBCC6Div" style="display: none">
                <input type="checkbox" id="RBCC6" class="pbComment">
                <label for="RBCC6"><b>RBCC6:</b> The red cell indices, morphology, and iron studies are suggestive of iron deficiency anemia and/or anemia of chronic disease. Clinical correlation is recommended.</label>
              </div>
              <div id="RBCC7Div" style="display: none">
                <input type="checkbox" id="RBCC7" class="pbComment">
                <label for="RBCC7"><b>RBCC7:</b> Although rare schistocytes are seen, the findings are not definite for acute microangiopathic hemolysis. Clinical correlation is suggested.</label>
              </div>
              <div id="RBCC8Div" style="display: none">
                <input type="checkbox" id="RBCC8" class="pbComment">
                <label for="RBCC8"><b>RBCC8:</b> The presence of schistocytes raises the possibility of a microangiopathic hemolysis. Clinical correlation suggested.</label>
              </div>
              <div id="RBCC9Div" style="display: none">
                <input type="checkbox" id="RBCC9" class="pbComment">
                <label for="RBCC9"><b>RBCC9:</b> The presence of spherocytes raises the possibility of immune hemolysis. Clinical correlation suggested.</label>
              </div>
              <div id="RBCC10Div" style="display: none">
                <input type="checkbox" id="RBCC10" class="pbComment">
                <label for="RBCC10"><b>RBCC10:</b> The presence of bite/blister cells raises the possibility of a Heinz body hemolytic anemia. If clinically indicated, submitting a fresh blood sample for Heinz body test is suggested.</label>
              </div>
              <div id="RBCC11Div" style="display: none">
                <input type="checkbox" id="RBCC11" class="pbComment">
                <label for="RBCC11"><b>RBCC11:</b> Correlation with vitamin B12 and folate levels recommended to evaluate the macrocytic anemia.</label>
              </div>
              <div id="RBCC12Div" style="display: none">
                <input type="checkbox" id="RBCC12" class="pbComment">
                <label for="RBCC12"><b>RBCC12:</b> The red cell indices and morphology are suggestive of a thalassemia. If clinically indicated, hemoglobin electrophoresis is recommended for further evaluation.</label>
              </div>
              <div id="RBCC13Div" style="display: none">
                <input type="checkbox" id="RBCC13" class="pbComment">
                <label for="RBCC13"><b>RBCC13:</b> The red cell indices and morphology are consistent with the patient's history of thalassemia.</label>
              </div>
              <div id="RBCC14Div" style="display: none">
                <input type="checkbox" id="RBCC14" class="pbComment">
                <label for="RBCC14"><b>RBCC14:</b> Red blood cell agglutination resolves by preheating, consistent with a cold agglutinin.</label>
              </div>
            </div>
            <br>
            <div>
              <span><b><u>Neutrophil/blast Comments</u></b><input type="checkbox" id="neutCommentsShow" class="commentsShow">
                <label for="neutCommentsShow"> Show all</label></span>
              <div id="WBCC1Div" style="display: none">
                <input type="checkbox" id="WBCC1" class="pbComment">
                <label for="WBCC1"><b>WBCC1:</b> The etiology of the neutrophilia is unclear. Suggest follow up to rule out persistence.</label>
              </div>
              <div id="WBCC2Div" style="display: none">
                <input type="checkbox" id="WBCC2" class="pbComment">
                <label for="WBCC2"><b>WBCC2:</b> The etiology of the neutrophilia is unclear but is favored to be reactive in nature.</label>
              </div>
              <div id="WBCC3Div" style="display: none">
                <input type="checkbox" id="WBCC3" class="pbComment">
                <label for="WBCC3"><b>WBCC3:</b> The etiology of the neutropenia is unclear.</label>
              </div>
              <div id="WBCC4Div" style="display: none">
                <input type="checkbox" id="WBCC4" class="pbComment">
                <label for="WBCC4"><b>WBCC4:</b> The findings are consistent with recent history of colony stimulating factor therapy.</label>
              </div>
              <div id="WBCC5Div" style="display: none">
                <input type="checkbox" id="WBCC5" class="pbComment">
                <label for="WBCC5"><b>WBCC5:</b> The findings are worrisome for a myeloid neoplasm.</label>
              </div>
              <div id="WBCC6Div" style="display: none">
                <input type="checkbox" id="WBCC6" class="pbComment">
                <label for="WBCC6"><b>WBCC6:</b> If clinically indicated, molecular analysis suggested, including evaluation for BCR-ABL1, JAK-2, CALR, and MPL.</label>
              </div>
              <div id="WBCC7Div" style="display: none">
                <input type="checkbox" id="WBCC7" class="pbComment">
                <label for="WBCC7"><b>WBCC7:</b> The findings are consistent with acute leukemia. Correlation with flow cytometry is suggested.</label>
              </div>
            </div>
            <br>
            <div>
              <span><b><u>Lymphocyte Comments</u></b><input type="checkbox" id="lymphCommentsShow" class="commentsShow">
                <label for="lymphCommentsShow"> Show all</label></span>
              <div id="WBCC8Div" style="display: none">
                <input type="checkbox" id="WBCC8" class="pbComment">
                <label for="WBCC8"><b>WBCC8:</b> The etiology of the lymphocytosis is unclear but is favored to be reactive in nature.</label>
              </div>
              <div id="WBCC9Div" style="display: none">
                <input type="checkbox" id="WBCC9" class="pbComment">
                <label for="WBCC9"><b>WBCC9:</b> The etiology of the lymphocytosis is unclear. Suggest repeat CBC and differential to rule out persistence.</label>
              </div>
              <div id="WBCC10Div" style="display: none">
                <input type="checkbox" id="WBCC10" class="pbComment">
                <label for="WBCC10"><b>WBCC10:</b> The findings raise the possibility of a lymphoproliferative disorder. If clinically indicated, flow cytometric analysis may be considered for further evaluation.</label>
              </div>
              <div id="WBCC11Div" style="display: none">
                <input type="checkbox" id="WBCC11" class="pbComment">
                <label for="WBCC11"><b>WBCC11:</b> The findings raise the possibility of an acute viral infection. Correlation with clinical and serologic findings is recommended.</label>
              </div>
              <div id="WBCC12Div" style="display: none">
                <input type="checkbox" id="WBCC12" class="pbComment">
                <label for="WBCC12"><b>WBCC12:</b> The morphologic findings, together with the positive heterophile antibody test, are consistent with infectious mononucleosis. Clinical correlation is suggested.</label>
              </div>
              <div id="WBCC13Div" style="display: none">
                <input type="checkbox" id="WBCC13" class="pbComment">
                <label for="WBCC13"><b>WBCC13:</b> The findings are consistent with the patient's history of chronic lymphocytic leukemia.</label>
              </div>
            </div>
            <br>
            <div>
              <span><b><u>Platelet Comments</u></b><input type="checkbox" id="pltCommentsShow" class="commentsShow">
                <label for="pltCommentsShow"> Show all</label></span>
              <div id="PLTC1Div" style="display: none">
                <input type="checkbox" id="PLTC1" class="pbComment">
                <label for="PLTC1"><b>PLTC1:</b> The etiology of the patient's thrombocytopenia is not clear on review of the peripheral blood smear. There is no morphologic evidence of acute microangiopathic hemolysis. Clinical correlation is suggested.</label>
              </div>
              <div id="PLTC2Div" style="display: none">
                <input type="checkbox" id="PLTC2" class="pbComment">
                <label for="PLTC2"><b>PLTC2:</b> The etiology of the patient's anemia and thrombocytopenia is not clear on review of the peripheral blood smear. There is no morphologic evidence of acute microangiopathic hemolysis. Clinical correlation is suggested.</label>
              </div>
              <div id="PLTC3Div" style="display: none">
                <input type="checkbox" id="PLTC3" class="pbComment">
                <label for="PLTC3"><b>PLTC3:</b> The etiology of the patient's pancytopenia is not clear on review of the peripheral blood smear. There is no morphologic evidence of acute microangiopathic hemolysis. Clinical correlation is suggested.</label>
              </div>
              <div id="PLTC4Div" style="display: none" class="pbComment">
                <input type="checkbox" id="PLTC4" class="pbComment">
                <label for="PLTC4"><b>PLTC4:</b> The etiology of the thrombocytosis is not clear. Suggest follow up with CBC to rule out persistence.</label>
              </div>
              <div id="PLTC5Div" style="display: none" class="pbComment">
                <input type="checkbox" id="PLTC5" class="pbComment">
                <label for="PLTC5"><b>PLTC5:</b> The etiology of the thrombocytosis is not clear.</label>
              </div>
              <div id="PLTC6Div" style="display: none" class="pbComment">
                <input type="checkbox" id="PLTC6" class="pbComment">
                <label for="PLTC6"><b>PLTC6:</b> Platelet clumping is present; therefore, the automated platelet count may be an underestimate. If clinically indicated, redraw in a citrated (blue top) tube is suggested.</label>
              </div>
              <div id="PLTC7Div" style="display: none" class="pbComment">
                <input type="checkbox" id="PLTC7" class="pbComment">
                <label for="PLTC7"><b>PLTC7:</b> Platelet clumping is present, preventing an accurate reporting of platelet count by automated instrument. If clinically indicated, redraw in a citrated (blue top) tube is suggested.</label>
              </div>
              <div id="PLTC8Div" style="display: none" class="pbComment">
                <input type="checkbox" id="PLTC8" class="pbComment">
                <label for="PLTC8"><b>PLTC8:</b> If clinically indicated, molecular analysis suggested, including evaluation for BCR-ABL1, JAK-2, CALR, and MPL.</label>
              </div>
              <br><br>
              <div id="commentOtherDiv" class="other">
                <input type="checkbox" id="commentOther" class="pbComment">
                <label for="commentOther">&nbsp<b>Other:</b></label>
                <input type="text" class="otherInput" id="commentOtherInput">
              </div>
              <div id="HEMC1Div" class="pbComment">
                <input type="checkbox" id="HEMC1" class="pbComment">
                <label for="HEMC1"><b>HEMC1:</b></label>Dr. <input type="text" class="otherInput" id="HEMCDR1" size=12> discussed the case with <input type="text" id="HEMCDR2" size=12> at <input type="text" id="HEMCTime" size=5> on <input type="text" id="HEMCDate" size=5>.
              </div>
            </div>
          </div>
        </div>
        <div class="panelright" id='rightDiv'>
          <div id="templateScreen" class="rightpanel side-pad">
            <div class="final" id="final2"></div>
            <div id="everythingCopyText" class='top'>
              <div id="final">
                <div id="pbTableDiv" style="display: none">
                </div>



                <div id="finalDiagnosis" class="h1" style="display: none">
                  Final Diagnosis
                </div>
                <div id="finalCopyText" contenteditable="true"></div>
              </div>
            </div>
          </div>
          <div id="settingsScreen" class="rightpanel neg side-pad" style="display: none">
            <h3 style="margin-top: 0px">
              Settings:
            </h3>
            <table id="settingTable">
              <col style="width:60%">
              <col style="width:40%">
              <tr>
                <td>Always include hemoglobin count</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting1">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Only include hemoglobin count when abnormal</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting2">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Always include neutrophil count</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting3">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Only include neutrophil count when abnormal</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting4">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Include monocyte count when abnormal</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting5">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Include eosinophil count when abnormal</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting13">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Include basophil count when abnormal</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting14">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Always include lymphocyte count when abnormal</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting6">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Only include lymphocyte count when elevated</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting7" checked>
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Always include platelet count</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting8">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Only include platelet count when elevated</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting9">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Show blasts when found in differential</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting10" checked>
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Show shift to immaturity when immature granulocytes found in differential</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting11" checked>
                    <span class="slider round"></span>
                  </label></td>
              </tr>
              <tr>
                <td>Comment on next line</td>
                <td><label class="switch">
                    <input class="saveData" type="checkbox" id="setting12">
                    <span class="slider round"></span>
                  </label></td>
              </tr>
            </table>
            <br>
            <button type="button" id="saveButton">Save</button>
          </div>
        </div>
      </div>

    </div>

    <script>
      $(document).ready(function() {

        var themeColor = localStorage.getItem("themeColor");
        if (themeColor != null && themeColor != "null") {
          changeTheme(themeColor);
          $('#themeColor').val(themeColor)
        }

        var header = '';
        var subHeader = '';
        var cbcReport = '';
        var wbc, wbcLow, wbcHigh, hgb, hgbLow, hgbHigh, mcv, mcvLow, mcvHigh, mchc, mchcLow, mchcHigh, plt, pltLow, pltHigh, mpv, mpvLow, mpvHigh, neut, neutHigh, neutLow, nrbcAbs, lymph, lymphHigh, lymphLow, mono, monoHigh, monoLow, immature, eos, eosHigh, baso, basoHigh, nrbc, blast
        var anisoVar = '';
        var anisoIDList = [];
        var anisoOptionList = [];
        var finalAnisoList = [];
        var lastPanel = ''
        var cbcArray = [];
        window.keypressed = {};

        var settingArray = JSON.parse(localStorage.getItem("pbTemplateSaveFile"));
        if (settingArray != null && settingArray != "null") {
          for (var i = 0; i < settingArray.length; i++) {
            $('#' + settingArray[i][0]).prop('checked', settingArray[i][1])
          }
        }

        $('.rightpanelbutton').click(function() {
          showPanel(this.id.replace('Button', 'Screen'))
        })

        function pbTypeListChange(pbTypeList) {
          $('.pbCellTypeSave').each(function() {
            $(this).attr('placeholder', pbTypeList[this.id.replace('pbSave', '')])
          })

          $('.pbCellType').each(function() {
            $(this).html('<b>' + this.id.replace('pbLabel', '') + ". </b>" + pbTypeList[this.id.replace('pbLabel', '')])
          })
        }

        function showPanel(panelId) {
          if (panelId == 'templateScreen') {
            $('#copyPanel').show();
          } else {
            $('#copyPanel').hide();
          }
          $(".rightpanel").each(function() {
            if (this.id == panelId) {
              $("#" + this.id).show();
            } else {
              $("#" + this.id).hide()
            }

          })
        }

        function togglePanel(panelId) {
          if ($('#' + panelId).attr('style').indexOf('none') != -1) {
            $(".rightpanel").each(function() {
              if ($('#' + this.id).attr('style').indexOf('none') == -1) {
                lastPanel = this.id
                if (lastPanel == "templateScreen") {
                  $('#copyPanel').hide();
                }
              }
              $("#" + this.id).hide();
            })
            $('#' + panelId).show();
          } else {
            if (lastPanel == "templateScreen") {
              $('#copyPanel').show();
            }
            $('#' + panelId).hide();
            $('#' + lastPanel).show();
          }
        }

        $('.navigationButton').click(function() {
          $('#navigationPanel').toggle();
        })

        $('.rightpanelbutton').click(function() {
          var iconId = this.id + "Panel";
          $(".rightpanelbutton").each(function() {
            $("#" + this.id).addClass("icon");
            $("#" + this.id).removeClass("clickedIcon");
          })
          $("#" + this.id).addClass("clickedIcon");
          $("#" + this.id).removeClass("icon");
        })

        $('.iconPanel').click(function() {
          var iconId = this.id + "Panel";
          $(".iconPanel").each(function() {
            $("#" + this.id).addClass("icon");
            $("#" + this.id).removeClass("clickedIcon");
          })
          $("#" + this.id).addClass("clickedIcon");
          $("#" + this.id).removeClass("icon");

          $(".template-body").each(function() {
            if (this.id == iconId) {
              $("#" + this.id).show();

            } else {
              $("#" + this.id).hide()
            }
          })
        })

        $('.copy').click(function() {
          copyText($(this).attr('id') + "Text")
        })

        function copyText(element) {
          var aux = document.createElement("div");
          aux.setAttribute("contentEditable", true);
          aux.innerHTML = document.getElementById(element).innerHTML;
          aux.setAttribute("onfocus", "document.execCommand('selectAll',false,null)");
          document.getElementById('final2').appendChild(aux);
          aux.focus();
          document.execCommand("copy");
          document.getElementById('final2').removeChild(aux);
        }

        $('#requestedInput').keyup(function() {
          fillInfo();
        })

        $('#reasonInput').keyup(function() {
          fillInfo();
        })

        $('#pbDiv').change(function() {
          fillFinal();
        })

        $('#rbcShow').change(function() {
          if ($('#rbcShow').prop('checked')) {
            $('#hgbAdequateDiv').show();
            $('#microAnemiaDiv').show();
            $('#macroAnemiaDiv').show();
            $('#normoAnemiaDiv').show();
          } else {
            fillCBC();
          }
        })

        $('#neutShow').change(function() {
          if ($('#neutShow').prop('checked')) {
            $('#adequateNeutDiv').show();
            $('#neutrophiliaDiv').show();
            $('#neutropeniaDiv').show();
          } else {
            fillCBC();
          }
        })

        $('#lymphShow').change(function() {
          if ($('#lymphShow').prop('checked')) {
            $('#lymphocytosisSLDiv').show();
            $('#lymphocytosisReactDiv').show();
            $('#lymphocytosisNeoplasticDiv').show();
            $('#lymphopenia').show();
          } else {
            fillCBC();
          }
        })

        $('#pltShow').change(function() {
          if ($('#pltShow').prop('checked')) {
            $('#adequatePltDiv').show();
            $('#thrombocytopeniaDiv').show();
            $('#thrombocytosisDiv').show();
          } else {
            fillCBC();
          }
        })

        $('#anisoDiv').change(function() {
          createAniso();
          if (finalAnisoList.length > 0) {
            $('#including').prop('checked', true);
          } else {
            $('#including').prop('checked', false);
          }
        })

        $('#aniso').change(function() {
          if ($('#aniso').prop('checked')) {
            $('#rbcUnremarkable').prop('checked', false)
            $('#mildAniso').prop('checked', false)
            $('#rbcDescription').prop('checked', true)
            createAniso()
          } else {
            $('#anisoDiv').hide()
            $('#including').prop('checked', false)
            if (!$('#poly').prop('checked')) {
              $('#rbcDescription').prop('checked', false)
            }
          }
        })

        $('#mildAniso').change(function() {
          if ($('#mildAniso').prop('checked')) {
            $('#rbcUnremarkable').prop('checked', false)
            $('#aniso').prop('checked', false)
            $('#rbcDescription').prop('checked', true)
            createAniso()
          } else {
            $('#anisoDiv').hide()
            $('#including').prop('checked', false)
            if (!$('#poly').prop('checked')) {
              $('#rbcDescription').prop('checked', false)
            }

          }
        })

        $('#poly').change(function() {
          if ($('#poly').prop('checked')) {
            $('#rbcUnremarkable').prop('checked', false)
            $('#rbcDescription').prop('checked', true)
          } else {
            if (!$('#aniso').prop('checked') && !$('#mildAniso').prop('checked')) {
              $('#rbcDescription').prop('checked', false)
            }
          }
        })

        $('#rbcUnremarkable').change(function() {
          $('#aniso').prop('checked', false);
          $('#mildAniso').prop('checked', false);
          $('#poly').prop('checked', false);
          $('#rbcDescription').prop('checked', true)
          $('#including').prop('checked', false)
          $('#anisoDiv').hide()
        })

        $('#neutUnremarkable').change(function() {
          $('#toxic').prop('checked', false);
          $('#neutShift').prop('checked', false);
          $('#neutHypolobated').prop('checked', false);
          $('#neutHypogranular').prop('checked', false);
          $('#neutDescription').prop('checked', true)
        })

        $('.neutAbnormal').change(function() {
          $('#neutUnremarkable').prop('checked', false);
          $('#neutDescription').prop('checked', true);
        })

        $('#rbcOtherInput').keyup(function() {
          if ($('#rbcOtherInput').val() == "") {
            $('#rbcOther').prop('checked', false)
          } else {
            $('#rbcOther').prop('checked', true)
          }
          fillFinal()
        })

        $('#neutOtherInput').keyup(function() {
          if ($('#neutOtherInput').val() == "") {
            $('#neutOther').prop('checked', false)
          } else {
            $('#neutOther').prop('checked', true)
          }
          fillFinal()
        })

        $('#lymphOtherInput').keyup(function() {
          if ($('#lymphOtherInput').val() == "") {
            $('#lymphOther').prop('checked', false)
          } else {
            $('#lymphOther').prop('checked', true)
          }
          fillFinal()
        })

        $('#pltOtherInput').keyup(function() {
          if ($('#pltOtherInput').val() == "") {
            $('#pltOther').prop('checked', false)
          } else {
            $('#pltOther').prop('checked', true)
          }
          fillFinal()
        })

        $('#patientPanel').change(function() {
          fillInfo();
        })

        $('.commentsShow').change(function() {
          fillFinal();
        })

        $('.pbComment').change(function() {
          fillFinal();
        })

        $('#commentOtherInput').keyup(function() {
          if ($('#commentOtherInput').val() == "") {
            $('#commentOther').prop('checked', false)
          } else {
            $('#commentOther').prop('checked', true)
          }
          fillFinal()
        })

        $('#HEMC1Div').keyup(function() {
          if ($('#HEMCDR1').val() == "" && $('#HEMCDR2').val() == "" && $('#HEMCDRTime').val() == "") {
            $('#HEMC1').prop('checked', false)
          } else {
            $('#HEMC1').prop('checked', true)
          }
          fillFinal()
        })


        function listText(listToConvert) {
          var listText = "";
          if (listToConvert.length == 1) {
            return listToConvert[0];
          } else if (listToConvert.length == 2) {
            return listToConvert[0] + " and " + listToConvert[1]
          } else {
            for (var i = 0; i < listToConvert.length; i++) {
              if (i != listToConvert.length - 1) {
                listText += listToConvert[i] + ", ";
              } else {
                listText += "and " + listToConvert[i];
              }
            }
          }
          return listText
        }

        function listTextAniso(listToConvert) {
          var listText = "";
          if (listToConvert.length == 1) {
            return listToConvert[0];
          } else if (listToConvert.length == 2) {
            return listToConvert[0] + " and " + listToConvert[1]
          } else {
            var countArray = [];
            var counter = 0;
            for (var i = 0; i < listToConvert.length; i++) {
              if (listToConvert[i].indexOf("frequent") != -1) {
                counter = 0;
              } else if (listToConvert[i].indexOf("occasional") != -1) {
                counter = 1;
              } else if (listToConvert[i].indexOf("rare") != -1) {
                counter = 2;
              }
              countArray.push(counter)
            }
            counter = 0;
            for (var i = 0; i < listToConvert.length; i++) {
              if (i == countArray.lastIndexOf(countArray[i])) {
                listText += listToConvert[i];
                if (i != listToConvert.length - 1) {
                  listText += " with ";
                }
              } else if (counter == 0 && i == countArray.lastIndexOf(countArray[i]) - 1) {
                listText += listToConvert[i] + " and "
                counter = 0;
              } else if (counter > 0 && i == countArray.lastIndexOf(countArray[i]) - 1) {
                listText += listToConvert[i] + ", and "
                counter = 0;
              } else if (i != countArray.lastIndexOf(countArray[i]) - 1) {
                listText += listToConvert[i] + ", "
                counter++
              }
            }
          }
          return listText
        }

        function createAniso() {
          var anisoList = ['', 'acanthocytes', 'basophilic stippling', 'bite cells', 'blister cells', 'burr cells', 'echinocytes', 'elliptocytes', 'Howell-Jolly bodies', 'macrocytes', 'macroovalocytes', 'microcytes', 'ovalocytes', 'schistocytes', 'sickle cells', 'spherocytes', 'target cells', 'teardrop cells', 'teardrop forms']
          anisoOptionList = [];
          finalAnisoList = [];
          var count = 0;
          var testVar = ""
          $('.aniso').each(function() {
            if (anisoOptionList.indexOf($('#' + this.id).val()) == -1) {
              anisoOptionList.push($('#' + this.id).val())
            }
          })
          for (var i = 0; i < anisoOptionList.length; i++) {
            if (anisoOptionList[i] != '') {
              testVar += '<div><select id="aniso' + count + '" class="aniso">'
              for (var j = 0; j < anisoList.length; j++) {
                testVar += '<option value="' + anisoList[j] + '"'
                if (anisoList[j] == anisoOptionList[i]) {
                  testVar += ' selected'
                }
                testVar += '>' + anisoList[j].charAt(0).toUpperCase() + anisoList[j].slice(1) + '</option>';
              }
              anisoList.splice($.inArray(anisoOptionList[i], anisoList), 1);
              testVar += '</select>&nbsp<label><input type="radio" name="anisoQuant' + count + '" id="anisoFreq' + count + '"'
              if ($('#anisoFreq' + count).prop('checked')) {
                testVar += ' checked'
              }
              testVar += '> Frequent</label>';
              testVar += '</select>&nbsp<label><input type="radio" name="anisoQuant' + count + '" id="anisoOccas' + count + '"'
              if ($('#anisoOccas' + count).prop('checked')) {
                testVar += ' checked'
              }
              testVar += '> Occasional</label>';
              testVar += '</select>&nbsp<label><input type="radio" name="anisoQuant' + count + '" id="anisoRare' + count + '"'
              if ($('#anisoRare' + count).prop('checked')) {
                testVar += ' checked';
              }
              testVar += '> Rare</label></div>';

              if ($('#anisoFreq' + count).prop('checked')) {
                finalAnisoList.push('frequent ' + anisoOptionList[i]);
              } else if ($('#anisoOccas' + count).prop('checked')) {
                finalAnisoList.push('occasional ' + anisoOptionList[i]);
              } else if ($('#anisoRare' + count).prop('checked')) {
                finalAnisoList.push('rare ' + anisoOptionList[i]);
              } else {
                finalAnisoList.push(anisoOptionList[i]);
              }
            }
            count++;
          }
          testVar += '<div><select id="aniso' + count + '" class="aniso">'
          for (var i = 0; i < anisoList.length; i++) {
            testVar += '<option value="' + anisoList[i] + '"'
            testVar += '>' + anisoList[i].charAt(0).toUpperCase() + anisoList[i].slice(1) + '</option>';
          }
          testVar += '</select></div>';
          count++;
          $('#anisoDiv').html(testVar);
          $('#anisoDiv').show();
          anisoOptionList = anisoOptionList.filter(Boolean);
        }

        function parseCBC() {
          cbcArray = [];
          var cbcTable = "<table id='pbtable'><tr><th>Component</th><th>Result</th><th>Reference Range</th></tr>"
          if ($('#pbCBC').val() != "") {
            var cbcFinal = [];
            var collectedDate = "";
            var cbcText = ""
            var cbcVariables = ["WBC", "RBC", "HGB", "HCT", "MCV", "MCH", "MCHC", "RDW", "PLT", "MPV", "Absolute Blasts", "Absolute Neutrophil Promyelocytes", "Absolute Neutrophil Metamyelocytes", "Absolute Neutrophil Myelocytes", "Absolute Neutrophils", "Absolute Lymphocytes", "Absolute Basophils", "Absolute Monocytes", "Absolute Eosinophils", "Nucleated Red Blood Cells, Automated", "NRBC", "Absolute NRBC", "Absolute Immature Granulocytes", "Neutrophils", "Lymphocytes", "Monocytes", "Eosinophils", "Basophils", "Immature Granulocytes", "Blasts"];
            var cbcTableList = ["WBC", "RBC", "HGB", "HCT", "MCV", "MCH", "MCHC", "RDW", "PLT", "MPV", "Absolute Neutrophils", "Absolute Lymphocytes"]
            var cbcLines = $('#pbCBC').val().split("\n")
            var counter = 0;
            var componentIndex, valueIndex, rangeIndex, unitsIndex;
            var cbcTest = [];

            for (var i = 0; i < cbcLines.length; i++) {
              cbcFinal.push(cbcLines[i].split("\t"));
            }
            for (var i = 0; i < cbcFinal.length; i++) {
              if (cbcFinal[i][0].includes("Manual Differential")) {
                break;
              }
              if (cbcFinal[i].includes("Component")) {
                componentIndex = cbcFinal[i].indexOf("Component");
                if (cbcFinal[i].indexOf("Value") != -1) {
                  valueIndex = cbcFinal[i].indexOf("Value");
                  rangeIndex = cbcFinal[i].indexOf("Ref. Range");
                  unitsIndex = cbcFinal[i].indexOf("Units");
                } else {
                  valueIndex = 2;
                  rangeIndex = 1;
                }
              }
            }
            for (var i = 0; i < cbcFinal.length; i++) {
              if (cbcFinal[i][componentIndex] != undefined) {


                if (cbcVariables.includes(cbcFinal[i][componentIndex].trim())) {
                  if (cbcFinal[i][rangeIndex].indexOf("-") != -1) {
                    cbcArray.push([cbcFinal[i][componentIndex].trim(), parseFloat(cbcFinal[i][valueIndex].replace(/[^\d.-]/g, '')), parseFloat(cbcFinal[i][rangeIndex].split("-")[0].replace(/[^\d.-]/g, '')).toFixed(1), parseFloat(cbcFinal[i][rangeIndex].split("-")[1].replace(/[^\d.-]/g, '')).toFixed(1), cbcFinal[i][unitsIndex]])
                  } else {
                    cbcArray.push([cbcFinal[i][componentIndex], cbcFinal[i][valueIndex], "-"])
                  }
                }
              }
            }
          } else {
            cbcArray = [];
          }
          fillCBC();
          for (let i = 0; i < cbcArray.length; i++) {
            if (cbcArray[i][1] != "" && cbcArray[i][2] !== "" && cbcArray[i][1] > cbcArray[i][3]) {
              cbcTable += "<tr style='background-color:#FF7A7A'><td>"
            } else if (cbcArray[i][1] != "" && cbcArray[i][2] !== "" && cbcArray[i][1] < cbcArray[i][2]) {
              cbcTable += "<tr style='background-color:#3DCEF5'><td>"
            } else {
              cbcTable += "<tr><td>"
            }
            if (cbcArray[i][0] == "Absolute Immature Granulocytes") {
              cbcTable += cbcArray[i][0] + "</td><td>" + cbcArray[i][1] + "</td><td>" + (0.02 * neut).toFixed(2) + "</td></tr>";
            } else if (cbcArray[i][2] == "-") {
              cbcTable += cbcArray[i][0] + "</td><td>" + cbcArray[i][1] + "</td><td>" + ">= 0.0" + "</td></tr>"
            } else {
              cbcTable += cbcArray[i][0] + "</td><td>" + cbcArray[i][1] + "</td><td>" + cbcArray[i][2] + " - " + cbcArray[i][3] + " " + cbcArray[i][4] + "</td></tr>"
            }

          }
          cbcTable += "</table><br>"

          $("#pbTableDiv").html(cbcTable);
          $("#pbTableDiv").show();

        }

        $('#pbCBC').bind('input', function() {
          parseCBC();
        })

        function fillCBC() {
          var finalText = "";
          for (let i = 0; i < cbcArray.length; i++) {
            if (cbcArray[i][0] == "WBC") {
              wbc = cbcArray[i][1];
              wbcLow = cbcArray[i][2];
              wbcHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "HGB") {
              hgb = cbcArray[i][1];
              hgbLow = cbcArray[i][2];
              hgbHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "MCV") {
              mcv = cbcArray[i][1];
              mcvLow = cbcArray[i][2];
              mcvHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "MCHC") {
              mchc = cbcArray[i][1];
              mchcLow = cbcArray[i][2];
              mchcHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "PLT") {
              plt = cbcArray[i][1];
              pltLow = cbcArray[i][2];
              pltHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "MPV") {
              mpv = cbcArray[i][1];
              mpvLow = cbcArray[i][2];
              mpvHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "Absolute Neutrophils") {
              neut = cbcArray[i][1];
              neutLow = cbcArray[i][2];
              neutHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "Absolute Lymphocytes") {
              lymph = cbcArray[i][1];
              lymphLow = cbcArray[i][2];
              lymphHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "Absolute Monocytes") {
              mono = cbcArray[i][1];
              monoLow = cbcArray[i][2];
              monoHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "Absolute Eosinophils") {
              eos = cbcArray[i][1];
              eosHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "Absolute Basophils") {
              baso = cbcArray[i][1];
              basoHigh = cbcArray[i][3];
            } else if (cbcArray[i][0] == "NRBC") {
              nrbc = cbcArray[i][1];
            } else if (cbcArray[i][0] == "Absolute NRBC") {
              nrbcAbs = cbcArray[i][1];
            } else if (cbcArray[i][0] == "Immature Granulocytes") {
              immature = cbcArray[i][1];
            } else if (cbcArray[i][0] == "Blasts") {
              blast = cbcArray[i][1];
            }
          }

          if (hgb < hgbLow) {
            if (mcv < mcvLow) {
              if (mchc < mchcLow) {
                $('#microAnemia').prop('checked', true);
                $('#hypochromicMicro').prop('checked', true);
                $('#hypochromicNormo').prop('checked', false);
                $('#macroAnemia').prop('checked', false);
                $('#normoAnemia').prop('checked', false);
                $('#hgbAdequate').prop('checked', false);
              } else {
                $('#microAnemia').prop('checked', true);
                $('#hypochromicNormo').prop('checked', false);
                $('#hypochromicMicro').prop('checked', false);
                $('#macroAnemia').prop('checked', false);
                $('#normoAnemia').prop('checked', false);
                $('#hgbAdequate').prop('checked', false);
              }
            } else if (mcv > mcvHigh) {
              $('#microAnemia').prop('checked', false);
              $('#hypochromicNormo').prop('checked', false);
              $('#hypochromicMicro').prop('checked', false);
              $('#macroAnemia').prop('checked', true);
              $('#normoAnemia').prop('checked', false);
              $('#hgbAdequate').prop('checked', false);
            } else if (mcv != undefined) {

              $('#microAnemia').prop('checked', false);
              $('#hypochromicMicro').prop('checked', false);
              $('#macroAnemia').prop('checked', false);
              $('#normoAnemia').prop('checked', true);
              $('#hgbAdequate').prop('checked', false);
            }
          } else if (hgb > hgbHigh) {

          } else if (hgb != undefined) {
            $('#microAnemia').prop('checked', false);
            $('#hypochromicNormo').prop('checked', false);
            $('#hypochromicMicro').prop('checked', false);
            $('#macroAnemia').prop('checked', false);
            $('#normoAnemia').prop('checked', false);
            $('#hgbAdequate').prop('checked', true);
          }

          if (nrbc > 0) {
            $('#nrbc').prop('checked', true);
            $('#nrbcQUantDiv').show();
          }

          if (nrbcAbs > 2) {
            $('#nrbcFrequent').prop('checked', true)
            $('#nrbcOccasional').prop('checked', false)
            $('#nrbcRare').prop('checked', false)
          } else if (nrbcAbs > 0.1) {
            $('#nrbcFrequent').prop('checked', false)
            $('#nrbcOccasional').prop('checked', true)
            $('#nrbcRare').prop('checked', false)
          } else if (nrbcAbs <= 0.1 && nrbcAbs > 0) {
            $('#nrbcFrequent').prop('checked', false)
            $('#nrbcOccasional').prop('checked', false)
            $('#nrbcRare').prop('checked', true)
          }

          if (neut < neutLow) {
            $('#neutropenia').prop('checked', true);
            $('#neutrophilia').prop('checked', false);
            $('#adequateNeut').prop('checked', false);
          } else if (neut > neutHigh) {
            $('#neutropenia').prop('checked', false);
            $('#neutrophilia').prop('checked', true);
            $('#adequateNeut').prop('checked', false);
          } else if (neut != undefined) {
            $('#neutropenia').prop('checked', false);
            $('#neutrophilia').prop('checked', false);
            $('#adequateNeut').prop('checked', true);
          }

          if (immature > 1) {
            if ($('#setting11').prop('checked')) {
              $('#neutShift').prop('checked', true);
              $('#neutDescription').prop('checked', true);
            }
          }

          if (mono > monoHigh) {
            $('#monocytosis').prop('checked', true);
          } else if (mono != undefined) {
            $('#monocytosisDiv').hide();
          }

          if (eos > eosHigh) {
            $('#eosinophilia').prop('checked', true);
          } else if (eos != undefined) {
            $('#eosinophiliaDiv').hide();
          }

          if (baso > basoHigh) {
            $('#basophilia').prop('checked', true);
          } else if (baso != undefined) {
            $('#basophiliaDiv').hide();
          }

          if (blast > 0) {
            $('#blast').prop('checked', true);
          }

          if (lymph < lymphLow * 0.2) {
            $('#lymphopenia').prop('checked', true);
            $('#lymphocytosisSL').prop('checked', false);
            $('#lymphocytosisReact').prop('checked', false);
            $('#lymphocytosisNeoplastic').prop('checked', false);
          } else if (lymph <= lymphHigh) {
            $('#lymphocytosisSL').prop('checked', false);
            $('#lymphocytosisReact').prop('checked', false);
            $('#lymphocytosisNeoplastic').prop('checked', false);
            if (!$('#lymphShow').prop('checked')) {
              $('#lymphocytosisSLDiv').hide();
              $('#lymphocytosisReactDiv').hide();
              $('#lymphocytosisNeoplasticDiv').hide();
            }
          }

          if (plt < pltLow) {
            $('#thrombocytopenia').prop('checked', true);
            $('#thrombocytosis').prop('checked', false);
            $('#adequatePlt').prop('checked', false);
          } else if (plt > pltHigh) {
            $('#thrombocytopenia').prop('checked', false);
            $('#thrombocytosis').prop('checked', true);
            $('#adequatePlt').prop('checked', false);
          } else if (plt != undefined) {
            $('#thrombocytopenia').prop('checked', false);
            $('#thrombocytosis').prop('checked', false);
            $('#adequatePlt').prop('checked', true);
          }
          fillFinal();
        }

        function fillFinal() {
          var rareShist, shist, spher, biteblist = ""
          var finalText = "";
          if ($('#reasonInput').val() != "") {
            $('#reasonFinal').html($('#reasonInput').val() + '<br><br>');
          } else if ($('#requestedInput').val() != "") {
            $('#testFinal').html("Peripheral Blood Smear Pathologist Interpretation Requested by: " + $('#requestedInput').val() + '<br><br>');
          }

          if (finalAnisoList.indexOf('rare schistocytes') != -1) {
            $('#RBCC7Div').show();
            rareShist = true;
          } else if (rareShist != true) {
            $('#RBCC7Div').hide();
          }

          for (let i = 0; i < finalAnisoList.length; i++) {
            if (finalAnisoList[i].indexOf('schistocytes') != -1) {
              $('#RBCC8Div').show();
              shist = true;
            } else if (shist != true) {
              $('#RBCC8Div').hide();
            }
          }

          for (let i = 0; i < finalAnisoList.length; i++) {
            if (finalAnisoList[i].indexOf('spherocytes') != -1) {
              $('#RBCC9Div').show();
              spher = true;
            } else if (spher != true) {
              $('#RBCC9Div').hide();
            }
          }

          for (let i = 0; i < finalAnisoList.length; i++) {
            if (finalAnisoList[i].indexOf('bite') != -1 || finalAnisoList[i].indexOf('blister') != -1) {
              $('#RBCC10Div').show();
              biteblist = true;
            } else if (biteblist != true) {
              $('#RBCC10Div').hide();
            }
          }

          if ($('#rbcDiv :checkbox:checked').length > 0) {
            if ($('input.rbcQuant:checkbox:checked').length > 1) {
              finalText += "***Incompatible RBC Characteristics***"
            } else if ($('#microAnemia').prop('checked')) {
              $('#RBCC1Div').show();
              $('#RBCC2Div').show();
              $('#RBCC3Div').show();
              $('#RBCC4Div').show();
              $('#RBCC5Div').show();
              $('#RBCC6Div').show();
              $('#RBCC12Div').show();
              $('#RBCC13Div').show();
              if ($('#hypochromicMicro').prop('checked')) {
                finalText += "Microcytic hypochromic anemia"
              } else {
                finalText += "Microcytic anemia"
              }
              if ($('#setting1').prop('checked') || $('#setting2').prop('checked')) {
                finalText += " (" + hgb + " g/dL)"
              }
              finalText += "."
              if (!$('#rbcShow').prop('checked')) {
                $('#hgbAdequateDiv').hide();
                $('#macroAnemiaDiv').hide();
                $('#normoAnemiaDiv').hide();
              }
            } else if ($('#macroAnemia').prop('checked')) {
              $('#RBCC1Div').show();
              $('#RBCC2Div').show();
              $('#RBCC3Div').hide();
              $('#RBCC5Div').show();
              $('#RBCC6Div').hide();
              $('#RBCC11Div').show();
              finalText += "Macrocytic anemia"
              if ($('#setting1').prop('checked') || $('#setting2').prop('checked')) {
                finalText += " (" + hgb + " g/dL)"
              }
              finalText += "."

              if (!$('#rbcShow').prop('checked')) {
                $('#hgbAdequateDiv').hide();
                $('#microAnemiaDiv').hide();
                $('#normoAnemiaDiv').hide();
              }
            } else if ($('#normoAnemia').prop('checked')) {
              $('#RBCC1Div').show();
              $('#RBCC2Div').show();
              $('#RBCC3Div').show();
              $('#RBCC5Div').show();
              $('#RBCC6Div').show();
              $('#RBCC10Div').hide();
              if ($('#hypochromicNormo').prop('checked')) {
                finalText += "Normocytic hypochromic anemia"
              } else {
                finalText += "Normocytic anemia"
              }
              if ($('#setting1').prop('checked') || $('#setting2').prop('checked')) {
                finalText += " (" + hgb + " g/dL)"
              }
              finalText += "."
              if (!$('#rbcShow').prop('checked')) {
                $('#hgbAdequateDiv').hide();
                $('#microAnemiaDiv').hide();
                $('#macroAnemiaDiv').hide();
              }
            } else if ($('#hgbAdequate').prop('checked')) {
              finalText += "Hemoglobin is adequate"
              if ($('#setting1').prop('checked')) {
                finalText += " (" + hgb + " g/dL)"
              }
              finalText += "."
              if (!$('#rbcShow').prop('checked')) {
                $('#microAnemiaDiv').hide();
                $('#macroAnemiaDiv').hide();
                $('#normoAnemiaDiv').hide();
              }
            } else {
              $('#hgbAdequateDiv').show();
              $('#microAnemiaDiv').show();
              $('#macroAnemiaDiv').show();
              $('#normoAnemiaDiv').show();
            }

            if ($('#rbcDescription').prop('checked')) {
              if ($('#rbcUnremarkable').prop('checked')) {
                finalText += " Red blood cells show unremarkable morphology."

              } else if ($('#poly').prop('checked') && !$('#aniso').prop('checked') && !$('#mildAniso').prop('checked')) {
                finalText += ' Red blood cells show polychromasia.';
              } else if ($('#poly').prop('checked') && ($('#aniso').prop('checked') || $('#mildAniso').prop('checked'))) {
                finalText += ' Red blood cells show polychromasia and ';
                if (anisoOptionList[0] != undefined && anisoOptionList[0] != "" && $('#including').prop('checked')) {
                  if ($('#aniso').prop('checked')) {
                    finalText += 'anisopoikilocytosis including ' + listTextAniso(finalAnisoList) + '.'
                  } else {
                    finalText += 'mild anisopoikilocytosis including ' + listTextAniso(finalAnisoList) + '.'
                  }
                } else {
                  if ($('#aniso').prop('checked')) {
                    finalText += 'non-specific anisopoikilocytosis.'
                  } else {
                    finalText += 'mild non-specific anisopoikilocytosis.'
                  }
                }
              } else if ($('#aniso').prop('checked') || $('#mildAniso').prop('checked')) {
                finalText += ' Red blood cells show '
                if (anisoOptionList[0] != undefined && anisoOptionList[0] != "" && $('#including').prop('checked')) {
                  if ($('#aniso').prop('checked')) {
                    finalText += 'anisopoikilocytosis including ' + listTextAniso(finalAnisoList) + '.'
                  } else {
                    finalText += 'mild anisopoikilocytosis including ' + listTextAniso(finalAnisoList) + '.'
                  }
                } else {
                  if ($('#aniso').prop('checked')) {
                    finalText += 'non-specific anisopoikilocytosis.'
                  } else {
                    finalText += 'mild non-specific anisopoikilocytosis.'
                  }
                }
              }
            }

            if ($('#nrbc').prop('checked')) {
              $('#nrbcQuantDiv').show();
              if ($('#nrbcFrequent').prop('checked')) {
                finalText += " Frequent nucleated red blood cells identified."
              } else if ($('#nrbcOccasional').prop('checked')) {
                finalText += " Occasional nucleated red blood cells identified."
              } else if ($('#nrbcRare').prop('checked')) {
                finalText += " Rare nucleated red blood cells identified."
              } else {
                finalText += " Nucleated red blood cells identified.";
              }
            }
            if ($('#agglutination').prop('checked')) {
              $('#RBCC14Div').show();
              finalText += " Red blood cells show agglutination. See comment.";
            }

            if ($('#rbcOther').prop('checked')) {
              finalText += " " + $('#rbcOtherInput').val();
            }
          } else {
            $('#hgbAdequateDiv').show();
            $('#microAnemiaDiv').show();
            $('#macroAnemiaDiv').show();
            $('#normoAnemiaDiv').show();
            $('#RBCC1Div').hide();
            $('#RBCC2Div').hide();
            $('#RBCC3Div').hide();
            $('#RBCC4Div').hide();
            $('#RBCC5Div').hide();
            $('#RBCC6Div').hide();
            $('#RBCC7Div').hide();
            $('#RBCC8Div').hide();
            $('#RBCC9Div').hide();
            $('#RBCC10Div').hide();
            $('#RBCC11Div').hide();
            $('#RBCC12Div').hide();
            $('#RBCC13Div').hide();
            $('#RBCC14Div').hide();
          }

          if ($('#blast').prop('checked') && finalText != "") {
            finalText += '<br><br>'
          }

          if ($('#blast').prop('checked')) {
            $('#WBCC3Div').show();
            $('#WBCC4Div').show();
            $('#WBCC5Div').show();
            $('#WBCC6Div').show();
            blast = $('#blastCount').val();
            if ((isNaN($('#blastCount').val()) || $('#blastCount').val() == "") && (blast == undefined || blast == "")) {
              blast = "";
              var blastString = "";
            } else if (isNaN($('#blastCount').val()) || $('#blastCount').val() == "") {
              var blastString = "(" + blast + "%) ";
            } else {
              blast = parseFloat($('#blastCount').val())
              var blastString = "(" + blast + "%) ";
            }
            $('#blastLabel').html("<b>WBC6:</b> Blasts are present (<input type='text' id='blastCount' size='1' value='" + blast + "'>%). See comment.")
            finalText += "Blasts are present " + blastString + ". See comment.";
          }

          if ($('#neutDiv :checkbox:checked').length > 0 && finalText != "") {
            finalText += "<br><br>"
          }

          if ($('#neutDiv :checkbox:checked').length > 0) {
            if ($('#neutQuantDiv :checkbox:checked').length > 1) {
              finalText += "***Incompatible Neutrophil Characteristics***"
            } else {
              if ($('#neutropenia').prop('checked')) {
                $('#WBCC1Div').hide();
                $('#WBCC2Div').hide();
                $('#WBCC3Div').show();
                finalText += "Absolute neutropenia"
                if ($('#setting3').prop('checked') || $('#setting4').prop('checked')) {
                  finalText += " (" + neut.toFixed(1) + " K/uL)"
                }
                finalText += "."
                if (!$('#neutShow').prop('checked')) {
                  $('#neutrophiliaDiv').hide();
                  $('#adequateNeutDiv').hide();
                }
              } else if ($('#neutrophilia').prop('checked')) {
                $('#WBCC1Div').show();
                $('#WBCC2Div').show();
                $('#WBCC3Div').hide();
                $('#WBCC4Div').show();
                $('#WBCC5Div').show();
                $('#WBCC6Div').show();
                finalText += "Absolute neutrophilia"
                if ($('#setting3').prop('checked') || $('#setting4').prop('checked')) {
                  finalText += " (" + neut.toFixed(1) + " K/uL)"
                }
                finalText += "."
                if (!$('#neutShow').prop('checked')) {
                  $('#neutropeniaDiv').hide();
                  $('#adequateNeutDiv').hide();
                }
              } else if ($('#adequateNeut').prop('checked')) {
                $('#WBCC1Div').hide();
                $('#WBCC2Div').hide();
                $('#WBCC3Div').hide();
                finalText += "Neutrophils are adequate";
                if ($('#setting3').prop('checked')) {
                  finalText += " (" + neut.toFixed(1) + " K/uL)"
                }
                if ($('#neutUnremarkable').prop('checked')) {
                  finalText += " and show unremarkable morphology"
                }
                finalText += ".";
                if (!$('#neutShow').prop('checked')) {
                  $('#neutropeniaDiv').hide();
                  $('#neutrophiliaDiv').hide();
                }
              } else {
                $('#neutropeniaDiv').show();
                $('#neutrophiliaDiv').show();
                $('#adequateNeutDiv').show();
              }
            }

            if ($('#neutDescription').prop('checked')) {
              if ($('#neutUnremarkable').prop('checked')) {
                if (!$('#adequateNeut').prop('checked')) {
                  finalText += " Neutrophils show unremarkable morphology."
                }
              } else if ($('#neutDescriptionDiv :checkbox:checked').length > 1) {
                var neutDescriptorList = []
                if ($('#toxic').prop('checked')) {
                  neutDescriptorList.push("toxic changes")
                }

                if ($('#neutHypolobated').prop('checked')) {
                  $('#WBCC5Div').show();
                  neutDescriptorList.push("hypolobated nuclei")
                }

                if ($('#neutHypogranular').prop('checked')) {
                  $('#WBCC5Div').show();
                  neutDescriptorList.push("hypogranular forms")
                }

                if ($('#neutShift').prop('checked')) {
                  neutDescriptorList.push("a shift to immaturity")
                  $('#WBCC4Div').show();
                  $('#WBCC5Div').show();
                  $('#WBCC6Div').show();
                }
                finalText += " Neutrophils show " + listText(neutDescriptorList) + "."
              }
            }
            if ($('#neutOther').prop('checked')) {
              finalText += " " + $('#neutOtherInput').val();
            }
          } else {
            $('#neutropeniaDiv').show();
            $('#neutrophiliaDiv').show();
            $('#adequateNeutDiv').show();
            $('#WBCC1Div').hide();
            $('#WBCC2Div').hide();
            $('#WBCC3Div').hide();
            $('#WBCC4Div').hide();
            $('#WBCC5Div').hide();
            $('#WBCC6Div').hide();
            $('#WBCC7Div').hide();
          }

          if ((lymph > lymphHigh || $('#lymphDiv :checkbox:checked').length > 0) && finalText != "") {
            finalText += "<br><br>"
          }

          if (lymph > lymphHigh || $('#lymphDiv :checkbox:checked').length > 0) {
            if ($('#lymphQuantDiv :checkbox:checked').length > 1) {
              finalText += "***Incompatible Lymphocyte Characteristics***"
            } else {
              var lymphManual = $('#lymphCount').val();
              if ((isNaN(lymphManual) || lymphManual == "") && (lymph == undefined || lymph == "")) {
                lymph = "";
                var lymphString = "";
              } else if (isNaN(lymphManual) || lymphManual == "") {
                var lymphString = "(" + lymph.toFixed(1) + " K/uL) ";
              } else {
                lymph = parseFloat(lymphManual)
                var lymphString = "(" + lymph.toFixed(1) + " K/uL) ";
              }

              if ($('#lymphopenia').prop('checked')) {
                finalText += "Absolute lymphopenia"
                if ($('#setting6').prop('checked')) {
                  finalText += " (" + lymph.toFixed(1) + " K/uL)"
                }
                finalText += "."
                if (!$('#lymphShow').prop('checked')) {
                  $('#lymphocytosisSLDiv').hide();
                  $('#lymphocytosisReactDiv').hide();
                  $('#lymphocytosisNeoplasticDiv').hide();
                }
              } else if (lymph > lymphHigh && $('#lymphocytosis :checkbox:checked').length == 0) {
                $('#WBCC8Div').show();
                $('#WBCC9Div').show();
                $('#WBCC10Div').show();
                $('#WBCC11Div').show();
                $('#WBCC12Div').show();
                $('#WBCC13Div').show();
                finalText += "Absolute lymphocytosis.";
                if (!$('#lymphShow').prop('checked')) {
                  $('#lymphopeniaDiv').hide();
                }
                $('#lymphocytosisSLDiv').show();
                $('#lymphocytosisReactDiv').show();
                $('#lymphocytosisNeoplasticDiv').show();
              } else if ($('#lymphocytosisSL').prop('checked')) {
                $('#WBCC8Div').show();
                $('#WBCC9Div').show();
                $('#WBCC10Div').show();
                $('#WBCC11Div').hide();
                $('#WBCC12Div').hide();
                $('#WBCC13Div').show();
                $('#lymphSLLabel').html("<b>WBCC8:</b> Absolute lymphocytosis (<input type='text' id='lymphCount' size='1' value='" + lymph + "'> K/uL) consisting of small mature lymphocytes and large granular lymphocytes.");
                finalText += "Absolute lymphocytosis " + lymphString + "consisting of small mature lymphocytes and large granular lymphocytes.";
                if (!$('#lymphShow').prop('checked')) {
                  $('#lymphopeniaDiv').hide();
                  $('#lymphocytosisReactDiv').hide();
                  $('#lymphocytosisNeoplasticDiv').hide();
                }
              } else if ($('#lymphocytosisReact').prop('checked')) {
                $('#WBCC8Div').show();
                $('#WBCC9Div').show();
                $('#WBCC10Div').show();
                $('#WBCC11Div').show();
                $('#WBCC12Div').show();
                $('#WBCC13Div').show();
                $('#lymphReactLabel').html("<b>WBCC8:</b> Absolute lymphocytosis (<input type='text' id='lymphCount' size='1' value='" + lymph + "'> K/uL) consisting of a heterogenous population of lymphocytes including small mature lymphocytes, large granular lymphocytes, and activated lymphocytes.")
                finalText += "Absolute lymphocytosis " + lymphString + "consisting of a heterogenous population of lymphocytes including small mature lymphocytes, large granular lymphocytes, and activated lymphocytes."
                if (!$('#lymphShow').prop('checked')) {
                  $('#lymphopeniaDiv').hide();
                  $('#lymphocytosisSLDiv').hide();
                  $('#lymphocytosisNeoplasticDiv').hide();
                }
              } else if ($('#lymphocytosisNeoplastic').prop('checked')) {
                $('#lymphNeoplasticLabel').html("<b>WBCC9:</b> Absolute lymphocytosis (<input type='text' id='lymphCount' size='1' value='" + lymph + "'> K/uL) consisting of a population of predominantly small to medium-sized lymphocytes with clumped chromatin. See comment.")
                finalText += "Absolute lymphocytosis " + lymphString + "consisting of a population of predominantly small to medium-sized lymphocytes with clumped chromatin. See comment."
                if (!$('#lymphShow').prop('checked')) {
                  $('#lymphopeniaDiv').hide();
                  $('#lymphocytosisSLDiv').hide();
                  $('#lymphocytosisReactDiv').hide();
                }
              } else {
                $('#lymphopeniaDiv').show();
                $('#lymphocytosisSLDiv').show();
                $('#lymphocytosisReactDiv').show();
                $('#lymphocytosisNeoplasticDiv').show();
              }
              if ($('#lymphOther').prop('checked')) {
                finalText += " " + $('#lymphOtherInput').val();
              }
            }
          } else {
            $('#lymphSLLabel').html("<b>WBCC7:</b> Absolute lymphocytosis consisting of small mature lymphocytes and large granular lymphocytes.");
            $('#lymphReactLabel').html("<b>WBCC8:</b> Absolute lymphocytosis consisting of a heterogenous population of lymphocytes including small mature lymphocytes, large granular lymphocytes, and activated lymphocytes.");
            $('#lymphNeoplasticLabel').html("<b>WBCC9:</b> Absolute lymphocytosis consisting of a monotonous population of predominantly small to medium-sized lymphocytes with clumped chromatin. See comment.");
            if (lymph < lymphLow || lymph == undefined || lymph == "") {
              $('#lymphopeniaDiv').show();
            }
            if (lymph > lymphHigh || lymph == undefined || lymph == "") {
              $('#lymphocytosisSLDiv').show();
              $('#lymphocytosisReactDiv').show();
              $('#lymphocytosisNeoplasticDiv').show();
            }
            if (lymph == "" || lymph == undefined || lymph < lymphHigh) {
              $('#WBCC8Div').hide();
              $('#WBCC9Div').hide();
              $('#WBCC10Div').hide();
              $('#WBCC11Div').hide();
              $('#WBCC12Div').hide();
              $('#WBCC13Div').hide();
            }
          }

          if ($('#monocytosis').prop('checked') && finalText != "") {
            if ($('#setting5').prop('checked')) {
              finalText += "<br><br> Absolute monocytosis (" + mono.toFixed(1) + " K/uL) with mature-appearing morphology."
            } else {
              finalText += "<br><br> Absolute monocytosis with mature-appearing morphology."
            }
          }

          if ($('#eosinophilia').prop('checked') && finalText != "") {
            if ($('#setting13').prop('checked')) {
              finalText += "<br><br> Absolute eosinophilia (" + eos.toFixed(1) + " K/uL)."
            } else {
              finalText += "<br><br> Absolute eosinophilia."
            }
          }

          if ($('#basophilia').prop('checked') && finalText != "") {
            if ($('#setting14').prop('checked')) {
              finalText += "<br><br> Absolute basophilia (" + baso.toFixed(1) + " K/uL)."
            } else {
              finalText += "<br><br> Absolute basophilia."
            }
          }

          var plateletText = ""
          if ($('input.pltQuant:checkbox:checked').length > 1) {
            plateletText += "***Incompatible Platelet Characteristics***"
          } else if ($('#thrombocytopenia').prop('checked')) {
            $('#PLTC1Div').show();
            $('#PLTC2Div').show();
            $('#PLTC3Div').show();
            $('#PLTC4Div').hide();
            $('#PLTC5Div').hide();
            $('#PLTC7Div').hide();
            if (plt > 0.9 * pltLow) {
              plateletText += "Mild thrombocytopenia"
            } else if (plt < 0.2 * pltLow) {
              plateletText += "Marked thrombocytopenia"
            } else {
              plateletText += "Thrombocytopenia";
            }
            if ($('#setting8').prop('checked') || $('#setting9').prop('checked') && plt != undefined) {
              plateletText += " (" + plt + " K/uL)"
            }
            if (!$('#pltShow').prop('checked')) {
              $('#thrombocytosisDiv').hide();
              $('#adequatePltDiv').hide();
            }
            if ($('#thrombocytopeniaUM').prop('checked')) {
              plateletText += " with unremarkable platelet morphology.";
            } else if ($('#thrombocytopeniaOL').prop('checked')) {
              plateletText += " with occasional large platelets.";
            } else {
              plateletText += ".";
            }
          } else if ($('#thrombocytosis').prop('checked')) {
            $('#PLTC1Div').hide();
            $('#PLTC2Div').hide();
            $('#PLTC3Div').hide();
            $('#PLTC4Div').show();
            $('#PLTC5Div').show();
            $('#PLTC8Div').show();
            if (plt > 2 * pltHigh) {
              plateletText += "Marked thrombocytosis"
            } else if (plt < 1.1 * pltHigh) {
              plateletText += "Mild thrombocytosis"
            } else {
              plateletText += "Thrombocytosis";
            }
            if (($('#setting8').prop('checked') || $('#setting9').prop('checked')) && plt != undefined) {
              plateletText += " (" + plt + " K/uL)"
            }
            if (!$('#pltShow').prop('checked')) {
              $('#thrombocytopeniaDiv').hide();
              $('#adequatePltDiv').hide();
            }
            if ($('#thrombocytosisUM').prop('checked')) {
              plateletText += " with unremarkable platelet morphology.";
            } else if ($('#thrombocytosisOL').prop('checked')) {
              plateletText += " with occasional large platelets.";
            } else {
              plateletText += "."
            }
          } else if ($('#adequatePlt').prop('checked')) {
            $('#PLTC1Div').hide();
            $('#PLTC2Div').hide();
            $('#PLTC3Div').hide();
            $('#PLTC5Div').hide();
            $('#PLTC6Div').hide();
            $('#PLTC8Div').hide();
            plateletText += "Platelets are adequate";
            if ($('#setting8').prop('checked')) {
              plateletText += " (" + plt + " K/uL)"
            }
            if (!$('#pltShow').prop('checked')) {
              $('#thrombocytopeniaDiv').hide();
              $('#thrombocytosisDiv').hide();
            }

            if ($('#adequatePltUM').prop('checked')) {
              plateletText += " with unremarkable morphology.";;
            } else if ($('#adequatePltOL').prop('checked')) {
              plateletText += " with occasional large platelets.";
            } else {
              plateletText += ".";
            }


          } else {
            $('#PLTC1Div').hide();
            $('#PLTC2Div').hide();
            $('#PLTC3Div').hide();
            $('#PLTC4Div').hide();
            $('#PLTC5Div').hide();
            $('#PLTC6Div').hide();
            $('#PLTC7Div').hide();
            $('#PLTC8Div').hide();
            $('#thrombocytopeniaDiv').show();
            $('#thrombocytosisDiv').show();
            $('#adequatePltDiv').show();
          }

          if ($('#pltClumping').prop('checked')) {
            plateletText += " Platelet clumping is present. See comment."
            $('#PLTC6Div').show();
            $('#PLTC7Div').show();
          } else if (!$('#pltShow').prop('checked')) {
            $('#PLTC6Div').hide();
            $('#PLTC7Div').hide();
          }

          if ($('#pltOther').prop('checked')) {
            plateletText += " " + $('#pltOtherInput').val();
          }

          if (finalText != "" && plateletText != "") {
            finalText += "<br><br>"
          }

          finalText += plateletText;

          var commentText = "";
          if ($('#RBCC1').prop('checked')) {
            commentText += " The etiology of the patient's anemia is not clear on review of the peripheral blood smear.";
          }
          if ($('#RBCC2').prop('checked')) {
            commentText += " There is no morphologic evidence of hemolysis. Clinical correlation is suggested.";
          }
          if ($('#RBCC3').prop('checked')) {
            commentText += " The red cell indices, morphology, and iron studies are consistent with iron deficiency anemia.";
          }
          if ($('#RBCC4').prop('checked')) {
            commentText += " The red cell indices, morphology, and iron studies are consistent with iron deficiency anemia.";
          }
          if ($('#RBCC5').prop('checked')) {
            commentText += " The red cell indices and morphology are suggestive of iron deficiency anemia.";
          }
          if ($('#RBCC6').prop('checked')) {
            commentText += " The red cell indices, morphology, and iron studies are suggestive of iron deficiency anemia and/or anemia of chronic disease. Clinical correlation is recommended.";
          }
          if ($('#RBCC7').prop('checked')) {
            commentText += " Although rare schistocytes are seen, the findings are not definite for acute microangiopathic hemolysis. Clinical correlation is suggested.";
          }
          if ($('#RBCC8').prop('checked')) {
            commentText += " The presence of schistocytes raises the possibility of a microangiopathic hemolysis. Clinical correlation suggested.";
          }
          if ($('#RBCC9').prop('checked')) {
            commentText += " The presence of spherocytes raises the possibility of immune hemolysis. Clinical correlation suggested.";
          }
          if ($('#RBCC10').prop('checked')) {
            commentText += " The presence of bite/blister cells raises the possibility of a Heinz body hemolytic anemia. If clinically indicated, submitting a fresh blood sample for Heinz body test is suggested.";
          }
          if ($('#RBCC11').prop('checked')) {
            commentText += " Correlation with vitamin B12 and folate levels recommended to evaluate the macrocytic anemia.";
          }
          if ($('#RBCC12').prop('checked')) {
            commentText += " The red cell indices and morphology are suggestive of a thalassemia. If clinically indicated, hemoglobin electrophoresis is recommended for further evaluation.";
          }
          if ($('#RBCC13').prop('checked')) {
            commentText += " The red cell indices and morphology are consistent with the patient's history of thalassemia.";
          }
          if ($('#RBCC14').prop('checked')) {
            commentText += " Red blood cell agglutination resolves by preheating, consistent with a cold agglutinin.";
          }
          if ($('#WBCC1').prop('checked')) {
            commentText += " The etiology of the neutrophilia is unclear. Suggest follow up to rule out persistence.";
          }
          if ($('#WBCC2').prop('checked')) {
            commentText += " The etiology of the neutrophilia is unclear but is favored to be reactive in nature.";
          }
          if ($('#WBCC3').prop('checked')) {
            commentText += " The etiology of the neutropenia is unclear.";
          }
          if ($('#WBCC4').prop('checked')) {
            commentText += " The findings are consistent with recent history of colony stimulating factor therapy.";
          }
          if ($('#WBCC5').prop('checked')) {
            commentText += " The findings are worrisome for a myeloid neoplasm.";
          }
          if ($('#WBCC6').prop('checked')) {
            commentText += " If clinically indicated, molecular analysis suggested, including evaluation for BCR-ABL1, JAK-2, CALR, and MPL.";
          }
          if ($('#WBCC7').prop('checked')) {
            commentText += " The findings are consistent with acute leukemia. Correlation with flow cytometry is suggested.";
          }
          if ($('#WBCC8').prop('checked')) {
            commentText += " The etiology of the lymphocytosis is unclear but is favored to be reactive in nature.";
          }
          if ($('#WBCC9').prop('checked')) {
            commentText += " The etiology of the lymphocytosis is unclear. Suggest repeat CBC and differential to rule out persistance.";
          }
          if ($('#WBCC10').prop('checked')) {
            commentText += " The findings raise the possibility of a lymphoproliferative disorder. If clinically indicated, flow cytometric analysis may be considered for further evaluation.";
          }
          if ($('#WBCC11').prop('checked')) {
            commentText += " The findings raise the possibility of an acute viral infection. Correlation with clinical and serologic findings is recommended.";
          }
          if ($('#WBCC12').prop('checked')) {
            commentText += " The morphologic findings, together with the positive heterophile antibody test, are consistent with infectious mononucleosis. Clinical correlation is suggested.";
          }
          if ($('#WBCC13').prop('checked')) {
            commentText += " The findings are consistent with the patient's history of chronic lymphocytic leukemia.";
          }
          if ($('#PLTC1').prop('checked')) {
            commentText += " The etiology of the patient's thrombocytopenia is not clear on review of the peripheral blood smear. There is no morphologic evidence of acute microangiopathic hemolysis. Clinical correlation is suggested.";
          }
          if ($('#PLTC2').prop('checked')) {
            commentText += " The etiology of the patient's anemia and thrombocytopenia is not clear on review of the peripheral blood smear. There is no morphologic evidence of acute microangiopathic hemolysis. Clinical correlation is suggested.";
          }
          if ($('#PLTC3').prop('checked')) {
            commentText += " The etiology of the patient's pancytopenia is not clear on review of the peripheral blood smear. There is no morphologic evidence of acute microangiopathic hemolysis. Clinical correlation is suggested.";
          }
          if ($('#PLTC4').prop('checked')) {
            commentText += " The etiology of the thrombocytosis is not clear. Suggest follow up with CBC to rule out persistence.";
          }
          if ($('#PLTC5').prop('checked')) {
            commentText += " The etiology of the thrombocytosis is not clear.";
          }
          if ($('#PLTC6').prop('checked')) {
            commentText += " Platelet clumping is present; therefore, the automated platelet count may be an underestimate. If clinically indicated, redraw in a citrated (blue top) tube is suggested.";
          }
          if ($('#PLTC7').prop('checked')) {
            commentText += " Platelet clumping is present, preventing an accurate reporting of platelet count by automated instrument. If clinically indicated, redraw in a citrated (blue top) tube is suggested.";
          }
          if ($('#PLTC8').prop('checked')) {
            commentText += " If clinically indicated, molecular analysis suggested, including evaluation for BCR-ABL1, JAK-2, CALR, and MPL.";
          }
          if ($('#commentOther').prop('checked')) {
            commentText += " " + $('#commentOtherInput').val();
          }
          if ($('#HEMC1').prop('checked')) {
            if (($('#HEMCDR1').val() != "" || $('#HEMCDR2').val() != "" || $('#HEMCTime').val() != "") && $('#HEMCDate').val() == "") {
              $('#HEMCDate').val(new Date().getMonth() + 1 + '/' + new Date().getDate() + '/' + new Date().getFullYear())
            }
            if (($('#HEMCDR1').val() != "" && $('#HEMCDR2').val() != "" && $('#HEMCTime').val() != "") && $('#HEMCDate').val() != "") {
              commentText += " Dr. " + $('#HEMCDR1').val() + " discussed the case with " + $('#HEMCDR2').val() + " at " + $('#HEMCTime').val() + " on " + $('#HEMCDate').val();

            }
          }
          if (commentText != "" && finalText != "") {
            if ($('#setting12').prop('checked')) {
              finalText += "<br><br>" + "Comment: " + "<br>" + commentText
            } else {
              finalText += "<br><br>" + "Comment: " + commentText
            }
          } else if (commentText != "") {
            if ($('#setting12').prop('checked')) {
              finalText += "<br><br>" + "Comment: " + "<br>" + commentText
            } else {
              finalText += "Comment: " + commentText
            }
          }
          showComments();
          if (finalText.length > 0) {
            $('#finalDiagnosis').show();
          } else {
            $('#finalDiagnosis').hide();
          }
          $('#finalCopyText').html(finalText)
        }

        function showComments() {
          if ($('#rbcCommentsShow').prop('checked')) {
            $('#RBCC1Div').show();
            $('#RBCC2Div').show();
            $('#RBCC3Div').show();
            $('#RBCC4Div').show();
            $('#RBCC5Div').show();
            $('#RBCC6Div').show();
            $('#RBCC7Div').show();
            $('#RBCC8Div').show();
            $('#RBCC9Div').show();
            $('#RBCC10Div').show();
            $('#RBCC11Div').show();
            $('#RBCC12Div').show();
            $('#RBCC13Div').show();
            $('#RBCC14Div').show();
          }
          if ($('#neutCommentsShow').prop('checked')) {
            $('#WBCC1Div').show();
            $('#WBCC2Div').show();
            $('#WBCC3Div').show();
            $('#WBCC4Div').show();
            $('#WBCC5Div').show();
            $('#WBCC6Div').show();
            $('#WBCC7Div').show();
          }

          if ($('#lymphCommentsShow').prop('checked')) {
            $('#WBCC8Div').show();
            $('#WBCC9Div').show();
            $('#WBCC10Div').show();
            $('#WBCC11Div').show();
            $('#WBCC12Div').show();
            $('#WBCC13Div').show();
          }

          if ($('#pltCommentsShow').prop('checked')) {
            $('#PLTC1Div').show();
            $('#PLTC2Div').show();
            $('#PLTC3Div').show();
            $('#PLTC4Div').show();
            $('#PLTC5Div').show();
            $('#PLTC6Div').show();
            $('#PLTC7Div').show();
            $('#PLTC8Div').show();
          }
        }

        $('#toggleCBC').change(function() {
          if ($('#toggleCBC').prop('checked')) {
            $('#pbTableDiv').show();
          } else {
            $('#pbTableDiv').hide();
          }
        })

        $('#pbDiv').change(function() {
          fillFinal();
        })

        function changeTheme(newThemeColor) {
          $(".bannertopitem").css("background-color", newThemeColor);
          $(".btn").css("background-color", newThemeColor);
          $(".btn").css("border-color", newThemeColor);
          $(".panel-heading").css("background-color", newThemeColor);
          $(".panel").css("border-color", newThemeColor);
          $(".iconHead").css("background-color", newThemeColor);
          $(".copyHead").css("background-color", newThemeColor);
        }

        $('#themeColor').change(function() {
          changeTheme($('#themeColor').val());
        })

        $("#saveButton").click(function() {
          var saveFile = [];
          $(".saveData").each(function() {
            saveFile.push([this.id, $(this).prop('checked')])
          })
          localStorage.setItem("pbTemplateSaveFile", JSON.stringify(saveFile));
        })

      });

    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  </body>

</html>
